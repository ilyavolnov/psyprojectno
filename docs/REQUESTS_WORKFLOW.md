# Схема работы системы заявок

## Состояния заявок

```
┌─────────────────┐
│  АКТИВНЫЕ       │
│  archived = 0   │
│  deleted = 0    │
└────────┬────────┘
         │
         │ [В архив]
         ▼
┌─────────────────┐
│  АРХИВ          │
│  archived = 1   │
│  deleted = 0    │
└────────┬────────┘
         │
         │ [Удалить из архива]
         │ или [В корзину]
         ▼
┌─────────────────┐
│  КОРЗИНА        │
│  archived = 0   │
│  deleted = 1    │
└────────┬────────┘
         │
         │ [Удалить навсегда]
         ▼
┌─────────────────┐
│  УДАЛЕНО        │
│  (из БД)        │
└─────────────────┘
```

## Доступные действия

### Для активных заявок:
- ✏️ Редактировать (статус, специалист)
- 📦 В архив
- 🗑️ В корзину

### Для архивных заявок:
- ✏️ Редактировать (статус, специалист)
- 🗑️ Удалить из архива → в корзину
- ♻️ Восстановить → в активные

### Для заявок в корзине:
- ✏️ Редактировать (статус, специалист)
- 🗑️ Удалить навсегда (из БД)
- ♻️ Восстановить → в активные

## API Endpoints

### GET /api/requests
Получить список заявок с фильтрацией
- `?tab=all` - активные заявки (archived=0, deleted=0)
- `?tab=archive` - архивные заявки (archived=1)
- `?tab=deleted` - корзина (deleted=1)
- `?status=new|pending|completed` - фильтр по статусу
- `?type=consultation|specialist|...` - фильтр по типу

### GET /api/requests/:id
Получить одну заявку по ID

### POST /api/requests
Создать новую заявку

### PUT /api/requests/:id
Обновить заявку (статус, специалист)

### PUT /api/requests/:id/archive
Архивировать заявку или удалить из архива
- Без параметров: если archived=0 → archived=1, если archived=1 → deleted=1
- `?remove=true` - принудительно удалить из архива (в корзину)

### PUT /api/requests/:id/restore
Восстановить заявку из архива или корзины
- Устанавливает archived=0, deleted=0

### DELETE /api/requests/:id
Удалить заявку (в корзину или навсегда)
- Без параметров: если deleted=0 → deleted=1
- `?permanent=true` - принудительно удалить навсегда
- Автоматически: если deleted=1 → удаляет из БД

## Массовые операции

Все операции поддерживают массовое выполнение через чекбоксы:
- Массовое архивирование
- Массовое удаление из архива
- Массовое удаление (в корзину или навсегда)
- Массовое изменение статуса
- Массовое восстановление

## Логика определения действия

### Архивирование:
```javascript
if (request.archived === 1) {
    // Удалить из архива → в корзину
    archived = 0, deleted = 1
} else {
    // Архивировать
    archived = 1, deleted = 0
}
```

### Удаление:
```javascript
if (request.deleted === 1 || permanent === 'true') {
    // Удалить навсегда
    DELETE FROM requests
} else {
    // В корзину
    deleted = 1
}
```

### Восстановление:
```javascript
// Всегда восстанавливает в активные
archived = 0, deleted = 0
```
